
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../property-paths/">
      
      
        <link rel="next" href="../network-performance/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>NetworkRollback - netfox</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/mkdocs_puml/puml.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#networkrollback" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="netfox" class="md-header__button md-logo" aria-label="netfox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            netfox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NetworkRollback
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="netfox" class="md-nav__button md-logo" aria-label="netfox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    netfox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../upgrading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading netfox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    netfox
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            netfox
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/responsive-player-movement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Responsive player movement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/configuring-properties-from-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring properties from code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/rollback-caveats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rollback caveats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/interpolation-caveats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolation caveats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/servers-clients-ownership/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servers, clients, and ownership
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/authoritative-servers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authoritative servers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkTime
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network-time-synchronizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkTimeSynchronizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkEvents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interpolators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../property-paths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Property paths
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    NetworkRollback
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    NetworkRollback
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#network-rollback-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Network rollback loop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditional-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional simulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-awareness" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback-awareness
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#settings" class="md-nav__link">
    <span class="md-ellipsis">
      Settings
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network-performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkPerformance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nodes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Nodes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodes/tick-interpolator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TickInterpolator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodes/rollback-synchronizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RollbackSynchronizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodes/state-synchronizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StateSynchronizer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    netfox.noray
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            netfox.noray
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../netfox.noray/guides/noray/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Noray
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../netfox.noray/guides/packet-handshake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PacketHandshake
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    netfox.extras
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            netfox.extras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../netfox.extras/guides/base-net-input/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BaseNetInput
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../netfox.extras/guides/network-weapon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkWeapon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../netfox.extras/guides/rewindable-state-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RewindableStateMachine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../netfox.extras/guides/window-tiler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WindowTiler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#network-rollback-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Network rollback loop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditional-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional simulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-awareness" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback-awareness
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#settings" class="md-nav__link">
    <span class="md-ellipsis">
      Settings
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="networkrollback">NetworkRollback</h1>
<p>Orchestrates the network rollback loop. Provided as an autoload.</p>
<p>Due to latency, the server may receive inputs from clients from multiple ticks
ago. Whenever this happens, the server rewinds its time and resimulates the
whole game from the time of the new input. The resimulated ticks are then sent
to clients to update their state.</p>
<p>Also due to latency, clients may receive a state from the server that is
several ticks old. Clients rewind their simulation to the time of the latest
received state and resimulate from there.</p>
<p>On both clients and servers, simulated states are recorded for reuse later.</p>
<p>Further reading: <a href="https://www.gabrielgambetta.com/client-side-prediction-server-reconciliation.html">Client-Side Prediction and Server Reconciliation</a></p>
<p>Note that most of the time you do not need to use this class - the
<a href="../../nodes/rollback-synchronizer/">RollbackSynchronizer</a> node helps with writing rollback-aware behaviour.</p>
<h2 id="network-rollback-loop">Network rollback loop</h2>
<p><em>NetworkRollback</em> runs the <em>network rollback loop</em> after every network tick,
but before the <em>after tick</em> signal is fired.</p>
<p>The following is the network rollback loop in isolation:</p>
<div class='puml-container'><div class="puml light" style="display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="418px" preserveAspectRatio="xMidYMid meet" style="width:189px;height:418px;background:#FFFFFF;" version="1.1" viewBox="0 0 189 418" width="189px" zoomAndPan="magnify" class="diagram"><defs/><g><ellipse cx="93.877" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="90.5176" x="48.6182" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="70.5176" x="58.6182" y="71.1387">before_loop</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="115.7539" x="36" y="147.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95.7539" x="46" y="169.1074">on_prepare_tick</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114.9102" x="36.4219" y="201.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94.9102" x="46.4219" y="223.0762">on_process_tick</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="107.3398" x="40.207" y="255.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87.3398" x="50.207" y="277.0449">on_record_tick</text><polygon fill="#F1F1F1" points="70.5637,103.9688,117.1902,103.9688,129.1902,115.9688,117.1902,127.9688,70.5637,127.9688,58.5637,115.9688,70.5637,103.9688" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46.6265" x="70.5637" y="119.7769">Rollback</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80.2344" x="53.7598" y="331.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60.2344" x="63.7598" y="353.0137">after_loop</text><ellipse cx="93.877" cy="396.8438" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="93.877" cy="396.8438" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="30" y2="50"/><polygon fill="#181818" points="89.877,40,93.877,50,97.877,40,93.877,44" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="181.9375" y2="201.9375"/><polygon fill="#181818" points="89.877,191.9375,93.877,201.9375,97.877,191.9375,93.877,195.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="235.9063" y2="255.9063"/><polygon fill="#181818" points="89.877,245.9063,93.877,255.9063,97.877,245.9063,93.877,249.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="127.9688" y2="147.9688"/><polygon fill="#181818" points="89.877,137.9688,93.877,147.9688,97.877,137.9688,93.877,141.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="289.875" y2="299.875"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="163.7539" y1="299.875" y2="299.875"/><polygon fill="#181818" points="159.7539,216.9219,163.7539,206.9219,167.7539,216.9219,163.7539,212.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="163.7539" x2="163.7539" y1="115.9688" y2="299.875"/><line style="stroke:#181818;stroke-width:1;" x1="163.7539" x2="129.1902" y1="115.9688" y2="115.9688"/><polygon fill="#181818" points="139.1902,111.9688,129.1902,115.9688,139.1902,119.9688,135.1902,115.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="58.5637" x2="24" y1="115.9688" y2="115.9688"/><polygon fill="#181818" points="20,202.9219,24,212.9219,28,202.9219,24,206.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="24" x2="24" y1="115.9688" y2="311.875"/><line style="stroke:#181818;stroke-width:1;" x1="24" x2="93.877" y1="311.875" y2="311.875"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="311.875" y2="331.875"/><polygon fill="#181818" points="89.877,321.875,93.877,331.875,97.877,321.875,93.877,325.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="83.9688" y2="103.9688"/><polygon fill="#181818" points="89.877,93.9688,93.877,103.9688,97.877,93.9688,93.877,97.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="93.877" x2="93.877" y1="365.8438" y2="385.8438"/><polygon fill="#181818" points="89.877,375.8438,93.877,385.8438,97.877,375.8438,93.877,379.8438" style="stroke:#181818;stroke-width:1;"/></g></svg></div></div>

<p>Signal handlers must implement the right steps for rollback to work.</p>
<p>During <em>before_loop</em>, all rollback-aware nodes must submit where to start the
resimulation, by calling <code>NetworkRollback.notify_resimulation_start</code>.
Resimulation will begin from the earliest tick submitted.</p>
<p>In each <em>on_prepare_tick(tick)</em> handler, nodes must rewind their state to the
specified tick. If a state is not available for the given tick, use the latest
tick that is earlier than the given tick. Nodes may also register themselves as
being simulated by calling <code>NetworkRollback.notify_simulated</code>. This is not used
by <em>NetworkRollback</em> itself, but can be used by other nodes to check which
nodes are simulated in the current rollback tick.</p>
<p>For the <em>on_process_tick(tick)</em> signal, nodes must advance their simulation by
a single tick.</p>
<p>In <em>on_record_tick(tick)</em>, nodes must record their state for the given tick.
Note that since the simulation was advanced by one tick in the previous signal,
the <em>tick</em> parameter is incremented here.</p>
<p>The <em>after_loop</em> signal notifies its subscribers that the resimulation is done.
This can be used to change to the state that is appropriate for display.</p>
<p>The network rollback loop is part of the network tick loop as follows:</p>
<div class='puml-container'><div class="puml light" style="display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="766px" preserveAspectRatio="xMidYMid meet" style="width:324px;height:766px;background:#FFFFFF;" version="1.1" viewBox="0 0 324 766" width="324px" zoomAndPan="magnify" class="diagram"><defs/><g><ellipse cx="164.2686" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="201.7578" x="63.3896" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="181.7578" x="73.3896" y="71.1387">NetworkTime.before_tick_loop</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="170.123" x="79.207" y="159.6792"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="150.123" x="89.207" y="180.8179">NetworkTime.before_tick</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="146.1875" x="91.1748" y="213.6479"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126.1875" x="101.1748" y="234.7866">NetworkTime.on_tick</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="195.3008" x="66.6182" y="267.6167"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="175.3008" x="76.6182" y="288.7554">NetworkRollback.before_loop</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="220.5371" x="54" y="365.5854"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="200.5371" x="64" y="386.7241">NetworkRollback.on_prepare_tick</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="219.6934" x="54.4219" y="419.5542"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="199.6934" x="64.4219" y="440.6929">NetworkRollback.on_process_tick</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="212.123" x="58.207" y="473.5229"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192.123" x="68.207" y="494.6616">NetworkRollback.on_record_tick</text><polygon fill="#F1F1F1" points="140.9553,321.5854,187.5818,321.5854,199.5818,333.5854,187.5818,345.5854,140.9553,345.5854,128.9553,333.5854,140.9553,321.5854" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46.6265" x="140.9553" y="337.3936">Rollback</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="185.0176" x="71.7598" y="549.4917"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="165.0176" x="81.7598" y="570.6304">NetworkRollback.after_loop</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159.8398" x="84.3486" y="603.4604"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139.8398" x="94.3486" y="624.5991">NetworkTime.after_tick</text><polygon fill="#F1F1F1" points="117.6125,103.9688,210.9246,103.9688,222.9246,115.9688,210.9246,127.9688,117.6125,127.9688,105.6125,115.9688,117.6125,103.9688" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="16.2153" x="168.2686" y="138.1792">&gt;0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93.312" x="117.6125" y="119.7769">Ticks to simulate</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="6.9985" x="98.614" y="113.3745">0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="191.4746" x="68.5313" y="679.4292"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171.4746" x="78.5313" y="700.5679">NetworkTime.after_tick_loop</text><ellipse cx="164.2686" cy="744.3979" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="164.2686" cy="744.3979" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="30" y2="50"/><polygon fill="#181818" points="160.2686,40,164.2686,50,168.2686,40,164.2686,44" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="193.6479" y2="213.6479"/><polygon fill="#181818" points="160.2686,203.6479,164.2686,213.6479,168.2686,203.6479,164.2686,207.6479" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="247.6167" y2="267.6167"/><polygon fill="#181818" points="160.2686,257.6167,164.2686,267.6167,168.2686,257.6167,164.2686,261.6167" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="399.5542" y2="419.5542"/><polygon fill="#181818" points="160.2686,409.5542,164.2686,419.5542,168.2686,409.5542,164.2686,413.5542" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="453.5229" y2="473.5229"/><polygon fill="#181818" points="160.2686,463.5229,164.2686,473.5229,168.2686,463.5229,164.2686,467.5229" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="345.5854" y2="365.5854"/><polygon fill="#181818" points="160.2686,355.5854,164.2686,365.5854,168.2686,355.5854,164.2686,359.5854" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="507.4917" y2="517.4917"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="286.5371" y1="517.4917" y2="517.4917"/><polygon fill="#181818" points="282.5371,434.5386,286.5371,424.5386,290.5371,434.5386,286.5371,430.5386" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="286.5371" x2="286.5371" y1="333.5854" y2="517.4917"/><line style="stroke:#181818;stroke-width:1;" x1="286.5371" x2="199.5818" y1="333.5854" y2="333.5854"/><polygon fill="#181818" points="209.5818,329.5854,199.5818,333.5854,209.5818,337.5854,205.5818,333.5854" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="128.9553" x2="42" y1="333.5854" y2="333.5854"/><polygon fill="#181818" points="38,420.5386,42,430.5386,46,420.5386,42,424.5386" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42" x2="42" y1="333.5854" y2="529.4917"/><line style="stroke:#181818;stroke-width:1;" x1="42" x2="164.2686" y1="529.4917" y2="529.4917"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="529.4917" y2="549.4917"/><polygon fill="#181818" points="160.2686,539.4917,164.2686,549.4917,168.2686,539.4917,164.2686,543.4917" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="301.5854" y2="321.5854"/><polygon fill="#181818" points="160.2686,311.5854,164.2686,321.5854,168.2686,311.5854,164.2686,315.5854" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="583.4604" y2="603.4604"/><polygon fill="#181818" points="160.2686,593.4604,164.2686,603.4604,168.2686,593.4604,164.2686,597.4604" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="127.9688" y2="159.6792"/><polygon fill="#181818" points="160.2686,149.6792,164.2686,159.6792,168.2686,149.6792,164.2686,153.6792" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="637.4292" y2="647.4292"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="298.5371" y1="647.4292" y2="647.4292"/><polygon fill="#181818" points="294.5371,396.6519,298.5371,386.6519,302.5371,396.6519,298.5371,392.6519" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="298.5371" x2="298.5371" y1="115.9688" y2="647.4292"/><line style="stroke:#181818;stroke-width:1;" x1="298.5371" x2="222.9246" y1="115.9688" y2="115.9688"/><polygon fill="#181818" points="232.9246,111.9688,222.9246,115.9688,232.9246,119.9688,228.9246,115.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="105.6125" x2="24" y1="115.9688" y2="115.9688"/><polygon fill="#181818" points="20,382.6519,24,392.6519,28,382.6519,24,386.6519" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="24" x2="24" y1="115.9688" y2="659.4292"/><line style="stroke:#181818;stroke-width:1;" x1="24" x2="164.2686" y1="659.4292" y2="659.4292"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="659.4292" y2="679.4292"/><polygon fill="#181818" points="160.2686,669.4292,164.2686,679.4292,168.2686,669.4292,164.2686,673.4292" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="83.9688" y2="103.9688"/><polygon fill="#181818" points="160.2686,93.9688,164.2686,103.9688,168.2686,93.9688,164.2686,97.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="164.2686" x2="164.2686" y1="713.3979" y2="733.3979"/><polygon fill="#181818" points="160.2686,723.3979,164.2686,733.3979,168.2686,723.3979,164.2686,727.3979" style="stroke:#181818;stroke-width:1;"/></g></svg></div></div>

<h2 id="conditional-simulation">Conditional simulation</h2>
<p>During rollback, <em>NetworkRollback</em> loops over the full range of ticks to
resimulate. Some nodes may not need to be resimulated for the current tick,
e.g. because they don't have input for the current tick.</p>
<p><em>NetworkRollback</em> can be used to track nodes that will be simulated in the
current rollback tick. Register nodes that will be simulated by calling
<code>NetworkRollback.notify_simulated</code>. To check if a node has been registered,
call <code>NetworkRollback.is_simulated</code>.</p>
<h2 id="rollback-awareness">Rollback-awareness</h2>
<p><a href="../../nodes/rollback-synchronizer/">RollbackSynchronizer</a> considers nodes rollback-aware that implement the
<code>_rollback_tick</code> method. Rollback-aware nodes are nodes that can participate in
the rollback process, i.e. they can resimulate earlier ticks.</p>
<p>To check if a node is rollback-aware, call <code>NetworkRollback.is_rollback_aware</code>.
To actually run a rollback tick on them, call
<code>NetworkRollback.process_rollback</code>.</p>
<p>These methods are called by <a href="../../nodes/rollback-synchronizer/">RollbackSynchronizer</a> under the hood.</p>
<h2 id="settings">Settings</h2>
<p><img alt="Network rollback settings" src="../../assets/network-rollback-settings.png" /></p>
<p><em>Enabled</em> toggles network rollback. No signals are fired when disabled.</p>
<p><em>History limit</em> is the maximum number of recorded ticks to keep. Larger values
enable further rewinds and thus larger latencies, but consume more memory for
each node that is recorded.</p>
<p><em>Input redundancy</em> This is the number of previous input ticks to send along with 
the current tick. We send data unreliably over UDP for speed. In the event a packet is
 lost or arrives out of order we add some redundancy. You can calculate your target
 reliability % packet success chance by using the formula 
 <code>1 - (1 - packet_success_rate) ^ input_redundancy</code>.</p>
<p><em>Display offset</em> specifies the age of the tick to display. By displaying an
older state instead of the latest one, games can mask adjustments if a state
update is received from the server. The drawback is that the game will have
some latency built-in, as it reacts to player inputs with some delay. Setting
to zero will always display the latest game state.</p>
<p><em>Enable diff states</em> toggles diff states. By sending only state properties that
have changed, netfox can reduce the bandwidth needed to synchronize the game
between peers. See <a href="../../nodes/rollback-synchronizer/">RollbackSynchronizer</a> on how this is done and configured.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../assets/mkdocs_puml/puml.js"></script>
      
    
  </body>
</html>